groups:
  - name: agent_health
    interval: 15s
    rules:
      # Agent down alert
      - alert: AgentDown
        expr: cryptofunk_agent_status == 0
        for: 1m
        labels:
          severity: critical
          component: agent
        annotations:
          summary: "Agent {{ $labels.agent_type }} is down"
          description: "Agent {{ $labels.agent_type }} has been offline for more than 1 minute"

      # Agent high processing time
      - alert: AgentHighProcessingTime
        expr: histogram_quantile(0.95, rate(cryptofunk_agent_processing_duration_ms_bucket[5m])) > 5000
        for: 5m
        labels:
          severity: warning
          component: agent
        annotations:
          summary: "Agent {{ $labels.agent_type }} processing time is high"
          description: "95th percentile processing time for {{ $labels.agent_type }} is {{ $value | humanize }}ms (threshold: 5000ms)"

      # Low agent confidence
      - alert: LowAgentConfidence
        expr: cryptofunk_agent_signal_confidence < 0.3
        for: 10m
        labels:
          severity: info
          component: agent
        annotations:
          summary: "Agent {{ $labels.agent_type }} has low confidence"
          description: "Agent {{ $labels.agent_type }} confidence is {{ $value | humanizePercentage }} (threshold: 30%)"

      # No recent agent signals
      - alert: AgentNoRecentSignals
        expr: rate(cryptofunk_agent_signals_total[10m]) == 0
        for: 15m
        labels:
          severity: warning
          component: agent
        annotations:
          summary: "Agent {{ $labels.agent_type }} not generating signals"
          description: "Agent {{ $labels.agent_type }} hasn't generated any signals in the last 15 minutes"

      # LLM request failures
      - alert: HighLLMRequestLatency
        expr: histogram_quantile(0.95, rate(cryptofunk_llm_request_duration_ms_bucket[5m])) > 10000
        for: 5m
        labels:
          severity: warning
          component: llm
        annotations:
          summary: "LLM request latency is high"
          description: "95th percentile LLM latency is {{ $value | humanize }}ms (threshold: 10000ms)"

  - name: circuit_breakers
    interval: 10s
    rules:
      # Circuit breaker tripped
      - alert: CircuitBreakerTripped
        expr: cryptofunk_circuit_breaker_status == 1
        for: 30s
        labels:
          severity: critical
          component: risk
        annotations:
          summary: "Circuit breaker {{ $labels.breaker_type }} has tripped"
          description: "{{ $labels.breaker_type }} circuit breaker is active - trading halted"

      # Frequent circuit breaker trips
      - alert: FrequentCircuitBreakerTrips
        expr: rate(cryptofunk_circuit_breaker_trips_total[30m]) > 0.1
        for: 5m
        labels:
          severity: warning
          component: risk
        annotations:
          summary: "Frequent circuit breaker trips for {{ $labels.breaker_type }}"
          description: "Circuit breaker {{ $labels.breaker_type }} tripping {{ $value | humanize }} times/sec (threshold: 0.1/sec)"
